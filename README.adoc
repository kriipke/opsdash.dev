= Example Manifests for CIPipeline CRDs
:toc:

This document provides example manifests for three variations of the `CIPipeline` Custom Resource Definition (CRD) that represent the desired state of a CI pipeline for a containerized web service running on Kubernetes. Each section corresponds to a different CRD design:

* **CRD 1** – A basic pipeline definition including source configuration, triggers, stages, and notifications.
* **CRD 2** – A pipeline definition extended with artifact handling and environment configurations.
* **CRD 3** – An extensible pipeline definition that supports integration with various CI/CD tools via custom configuration fields.

Below are multiple example manifests for each CRD variant, annotated with AsciiDoc callouts to explain their usage and features.

== CRD 1: CIPipeline with Notifications

This CRD design focuses on a CI pipeline that defines the source repository, trigger mechanism (webhook or schedule), sequential pipeline stages, and notification settings (e.g., Slack or email).

=== Variation 1: Webhook-triggered Pipeline

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-webhook                             // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "main"                                          // <5>
    credentials:
      secretName: "repo-creds"                              // <6>
      secretKey: "token"                                    // <7>
  triggers:
    type: "webhook"                                         // <8>
    webhook:
      endpoint: "http://ci-trigger.example.com/webhook"     // <9>
      secret: "webhooksecret"                               // <10>
  stages:
    - name: "build"                                         // <11>
      type: "build"                                         // <12>
      job:
        image: "docker:latest"                              // <13>
        command: ["docker", "build", "-t", "example/webapp"] // <14>
        args: ["."]                                         // <15>
    - name: "test"                                          // <16>
      type: "test"                                          // <17>
      job:
        image: "node:14"                                    // <18>
        command: ["npm", "test"]                            // <19>
  notifications:
    - type: "slack"                                         // <20>
      slack:
        webhookURL: "https://hooks.slack.com/services/XXXX/XXXX/XXXX"  // <21>
----
<1> API version identifying the CRD group and version.
<2> The resource kind.
<3> Unique name of the CIPipeline instance.
<4> URL of the Git repository containing the source code.
<5> The branch to monitor.
<6>-<7> Reference to a Kubernetes Secret for repository credentials.
<8> Trigger type is set to "webhook".
<9>-<10> Webhook configuration with endpoint and secret.
<11>-<15> Definition of the "build" stage using a Docker job.
<16>-<19> Definition of the "test" stage using a Node.js job.
<20>-<21> Notification settings using Slack.

=== Variation 2: Scheduled Pipeline with Email and Slack Notifications

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-scheduled                          // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "develop"                                       // <5>
  triggers:
    type: "schedule"                                        // <6>
    schedule: "0 0 * * *"                                   // <7>
  stages:
    - name: "build"                                         // <8>
      type: "build"                                         // <9>
      job:
        image: "maven:3.6-jdk-11"                           // <10>
        command: ["mvn", "clean", "install"]                // <11>
    - name: "deploy"                                        // <12>
      type: "deploy"                                        // <13>
      job:
        image: "kubectl:latest"                             // <14>
        command: ["kubectl", "apply", "-f", "deployment.yaml"]  // <15>
  notifications:
    - type: "email"                                         // <16>
      email:
        addresses: ["devops@example.com"]                   // <17>
    - type: "slack"                                         // <18>
      slack:
        webhookURL: "https://hooks.slack.com/services/YYYY/YYYY/YYYY"  // <19>
----
<1>-<3> Standard resource identification.
<4>-<5> Source repository settings.
<6>-<7> Scheduled trigger configured via a cron expression.
<8>-<11> "Build" stage using Maven.
<12>-<15> "Deploy" stage that applies Kubernetes configuration.
<16>-<19> Notification configuration with both email and Slack.

== CRD 2: CIPipeline with Artifacts and Environments

This CRD design expands on the basic pipeline by adding fields for handling artifacts (like Docker images or external storage) and environment configurations (environment variables, ConfigMaps, and Secrets).

=== Variation 1: Pipeline Producing a Docker Image with Environment Variables

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-artifacts-env                      // <3>
spec:
  source:
    repo: "https://github.com/example/webapp.git"           // <4>
    branch: "main"                                          // <5>
    credentials:
      secretName: "repo-creds"                              // <6>
      secretKey: "token"                                    // <7>
  triggers:
    type: "manual"                                          // <8>
  stages:
    - name: "build"                                         // <9>
      type: "build"                                         // <10>
      job:
        image: "docker:latest"                              // <11>
        command: ["docker", "build", "-t", "example/webapp:latest"]  // <12>
        args: ["."]                                         // <13>
  artifacts:
    image: "example/webapp:latest"                          // <14>
  environments:
    variables:
      - name: "ENV"                                         // <15>
        value: "production"                                 // <16>
    configMapRef:
      name: "webapp-config"                                 // <17>
    secretRef:
      name: "webapp-secrets"                                // <18>
----
<1>-<3> Standard resource identification.
<4>-<7> Source configuration including credentials.
<8> Trigger type set to manual.
<9>-<13> "Build" stage definition for producing the Docker image.
<14> Artifact field indicating the produced image.
<15>-<16> Environment variable for production.
<17>-<18> References to ConfigMap and Secret for environment settings.

=== Variation 2: Scheduled Pipeline with External Artifact Storage

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-external-artifact                 // <3>
spec:
  source:
    repo: "https://github.com/example/webapp.git"           // <4>
    branch: "release"                                      // <5>
  triggers:
    type: "schedule"                                       // <6>
    schedule: "30 2 * * *"                                 // <7>
  stages:
    - name: "test"                                         // <8>
      type: "test"                                         // <9>
      job:
        image: "python:3.8"                                // <10>
        command: ["pytest"]                                // <11>
  artifacts:
    storage: "s3://my-artifacts-bucket/webapp"             // <12>
  environments:
    variables:
      - name: "DEBUG"                                       // <13>
        value: "false"                                     // <14>
----
<1>-<3> Resource identification.
<4>-<5> Repository details.
<6>-<7> Scheduled trigger using a cron expression.
<8>-<11> "Test" stage defined with Python and pytest.
<12> External artifact storage location (e.g., an S3 bucket).
<13>-<14> Environment variable to disable debugging.

== CRD 3: Extensible CIPipeline with CI/CD Tool Integration

This CRD design enhances extensibility by supporting integration with various CI/CD tools through additional fields such as `tool` and `customConfig` in each pipeline stage. These fields allow users to specify tool-specific options without altering the core schema.

=== Variation 1: Pipeline Using Tekton for Build and Deploy

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-tekton                             // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "main"                                          // <5>
  triggers:
    type: "webhook"                                         // <6>
    webhook:
      endpoint: "http://tekton-trigger.example.com/webhook" // <7>
      secret: "tektonsecret"                                // <8>
  stages:
    - name: "build"                                         // <9>
      type: "build"                                         // <10>
      tool: "Tekton"                                        // <11>
      jobSpec:
        image: "tekton/build:latest"                        // <12>
        command: ["build-task"]                             // <13>
      customConfig:                                         // <14>
        task: "build-webapp"                                // <15>
    - name: "deploy"                                        // <16>
      type: "deploy"                                        // <17>
      tool: "Tekton"                                        // <18>
      jobSpec:
        image: "tekton/deploy:latest"                       // <19>
        command: ["deploy-task"]                            // <20>
      customConfig:                                         // <21>
        task: "deploy-webapp"                               // <22>
  artifacts:
    image: "example/webapp:latest"                          // <23>
  environments:
    variables:
      - name: "ENV"                                         // <24>
        value: "staging"                                    // <25>
----
<1>-<3> Standard resource identification.
<4>-<5> Source repository configuration.
<6>-<8> Webhook trigger settings configured for Tekton.
<9>-<10> "Build" stage definition.
<11> Specifies that Tekton is used for the build stage.
<12>-<13> Job specification for the build stage.
<14>-<15> Custom Tekton configuration for the build task.
<16>-<17> "Deploy" stage definition.
<18> Specifies Tekton is used for the deploy stage.
<19>-<20> Job specification for the deploy stage.
<21>-<22> Custom Tekton configuration for the deploy task.
<23> Artifact produced by the pipeline.
<24>-<25> Environment variable indicating the staging environment.

=== Variation 2: Pipeline Using Jenkins for Testing with Custom Configuration

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-jenkins-test                       // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "feature/ci-enhancements"                       // <5>
  triggers:
    type: "manual"                                         // <6>
  stages:
    - name: "test"                                          // <7>
      type: "test"                                          // <8>
      tool: "Jenkins"                                       // <9>
      jobSpec:
        image: "jenkins/inbound-agent:latest"               // <10>
        command: ["sh", "-c", "run-tests.sh"]               // <11>
      customConfig:                                         // <12>
        jobName: "Webapp-Test-Job"                          // <13>
        parameters:                                         // <14>
          - key: "ENV"                                      // <15>
            value: "testing"                                // <16>
  artifacts:
    storage: "http://artifact-server.example.com/artifacts" // <17>
----
<1>-<3> Standard CIPipeline resource identification.
<4>-<5> Source repository and branch details.
<6> Trigger type set to manual.
<7>-<8> "Test" stage definition.
<9> Specifies Jenkins as the CI/CD tool.
<10>-<11> Job specification for the test stage.
<12>-<16> Custom Jenkins configuration with job name and parameters.
<17> Artifact storage location for test results.

== Summary

This document showcased three variations of the `CIPipeline` CRD:

* **CRD 1** – Focuses on defining a pipeline with basic source, trigger, stage, and notification configurations.
* **CRD 2** – Extends the pipeline definition with artifact management and environment-specific settings.
* **CRD 3** – Enhances extensibility by allowing integration with CI/CD tools (such as Tekton and Jenkins) through custom configuration fields.

Each manifest demonstrates different configurations and use cases, illustrating how the CIPipeline CRD can be adapted to various CI/CD workflows while leveraging Kubernetes-native objects for a seamless operational experience.
= Example Manifests for CIPipeline CRDs
:toc:

This document provides example manifests for three variations of the `CIPipeline` Custom Resource Definition (CRD) that represent the desired state of a CI pipeline for a containerized web service running on Kubernetes. Each section corresponds to a different CRD design:

* **CRD 1** – A basic pipeline definition including source configuration, triggers, stages, and notifications.
* **CRD 2** – A pipeline definition extended with artifact handling and environment configurations.
* **CRD 3** – An extensible pipeline definition that supports integration with various CI/CD tools via custom configuration fields.

Below are multiple example manifests for each CRD variant, annotated with AsciiDoc callouts to explain their usage and features.

== CRD 1: CIPipeline with Notifications

This CRD design focuses on a CI pipeline that defines the source repository, trigger mechanism (webhook or schedule), sequential pipeline stages, and notification settings (e.g., Slack or email).

=== Variation 1: Webhook-triggered Pipeline

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-webhook                             // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "main"                                          // <5>
    credentials:
      secretName: "repo-creds"                              // <6>
      secretKey: "token"                                    // <7>
  triggers:
    type: "webhook"                                         // <8>
    webhook:
      endpoint: "http://ci-trigger.example.com/webhook"     // <9>
      secret: "webhooksecret"                               // <10>
  stages:
    - name: "build"                                         // <11>
      type: "build"                                         // <12>
      job:
        image: "docker:latest"                              // <13>
        command: ["docker", "build", "-t", "example/webapp"] // <14>
        args: ["."]                                         // <15>
    - name: "test"                                          // <16>
      type: "test"                                          // <17>
      job:
        image: "node:14"                                    // <18>
        command: ["npm", "test"]                            // <19>
  notifications:
    - type: "slack"                                         // <20>
      slack:
        webhookURL: "https://hooks.slack.com/services/XXXX/XXXX/XXXX"  // <21>
----
<1> API version identifying the CRD group and version.
<2> The resource kind.
<3> Unique name of the CIPipeline instance.
<4> URL of the Git repository containing the source code.
<5> The branch to monitor.
<6>-<7> Reference to a Kubernetes Secret for repository credentials.
<8> Trigger type is set to "webhook".
<9>-<10> Webhook configuration with endpoint and secret.
<11>-<15> Definition of the "build" stage using a Docker job.
<16>-<19> Definition of the "test" stage using a Node.js job.
<20>-<21> Notification settings using Slack.

=== Variation 2: Scheduled Pipeline with Email and Slack Notifications

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-scheduled                          // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "develop"                                       // <5>
  triggers:
    type: "schedule"                                        // <6>
    schedule: "0 0 * * *"                                   // <7>
  stages:
    - name: "build"                                         // <8>
      type: "build"                                         // <9>
      job:
        image: "maven:3.6-jdk-11"                           // <10>
        command: ["mvn", "clean", "install"]                // <11>
    - name: "deploy"                                        // <12>
      type: "deploy"                                        // <13>
      job:
        image: "kubectl:latest"                             // <14>
        command: ["kubectl", "apply", "-f", "deployment.yaml"]  // <15>
  notifications:
    - type: "email"                                         // <16>
      email:
        addresses: ["devops@example.com"]                   // <17>
    - type: "slack"                                         // <18>
      slack:
        webhookURL: "https://hooks.slack.com/services/YYYY/YYYY/YYYY"  // <19>
----
<1>-<3> Standard resource identification.
<4>-<5> Source repository settings.
<6>-<7> Scheduled trigger configured via a cron expression.
<8>-<11> "Build" stage using Maven.
<12>-<15> "Deploy" stage that applies Kubernetes configuration.
<16>-<19> Notification configuration with both email and Slack.

== CRD 2: CIPipeline with Artifacts and Environments

This CRD design expands on the basic pipeline by adding fields for handling artifacts (like Docker images or external storage) and environment configurations (environment variables, ConfigMaps, and Secrets).

=== Variation 1: Pipeline Producing a Docker Image with Environment Variables

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-artifacts-env                      // <3>
spec:
  source:
    repo: "https://github.com/example/webapp.git"           // <4>
    branch: "main"                                          // <5>
    credentials:
      secretName: "repo-creds"                              // <6>
      secretKey: "token"                                    // <7>
  triggers:
    type: "manual"                                          // <8>
  stages:
    - name: "build"                                         // <9>
      type: "build"                                         // <10>
      job:
        image: "docker:latest"                              // <11>
        command: ["docker", "build", "-t", "example/webapp:latest"]  // <12>
        args: ["."]                                         // <13>
  artifacts:
    image: "example/webapp:latest"                          // <14>
  environments:
    variables:
      - name: "ENV"                                         // <15>
        value: "production"                                 // <16>
    configMapRef:
      name: "webapp-config"                                 // <17>
    secretRef:
      name: "webapp-secrets"                                // <18>
----
<1>-<3> Standard resource identification.
<4>-<7> Source configuration including credentials.
<8> Trigger type set to manual.
<9>-<13> "Build" stage definition for producing the Docker image.
<14> Artifact field indicating the produced image.
<15>-<16> Environment variable for production.
<17>-<18> References to ConfigMap and Secret for environment settings.

=== Variation 2: Scheduled Pipeline with External Artifact Storage

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-external-artifact                 // <3>
spec:
  source:
    repo: "https://github.com/example/webapp.git"           // <4>
    branch: "release"                                      // <5>
  triggers:
    type: "schedule"                                       // <6>
    schedule: "30 2 * * *"                                 // <7>
  stages:
    - name: "test"                                         // <8>
      type: "test"                                         // <9>
      job:
        image: "python:3.8"                                // <10>
        command: ["pytest"]                                // <11>
  artifacts:
    storage: "s3://my-artifacts-bucket/webapp"             // <12>
  environments:
    variables:
      - name: "DEBUG"                                       // <13>
        value: "false"                                     // <14>
----
<1>-<3> Resource identification.
<4>-<5> Repository details.
<6>-<7> Scheduled trigger using a cron expression.
<8>-<11> "Test" stage defined with Python and pytest.
<12> External artifact storage location (e.g., an S3 bucket).
<13>-<14> Environment variable to disable debugging.

== CRD 3: Extensible CIPipeline with CI/CD Tool Integration

This CRD design enhances extensibility by supporting integration with various CI/CD tools through additional fields such as `tool` and `customConfig` in each pipeline stage. These fields allow users to specify tool-specific options without altering the core schema.

=== Variation 1: Pipeline Using Tekton for Build and Deploy

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-tekton                             // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "main"                                          // <5>
  triggers:
    type: "webhook"                                         // <6>
    webhook:
      endpoint: "http://tekton-trigger.example.com/webhook" // <7>
      secret: "tektonsecret"                                // <8>
  stages:
    - name: "build"                                         // <9>
      type: "build"                                         // <10>
      tool: "Tekton"                                        // <11>
      jobSpec:
        image: "tekton/build:latest"                        // <12>
        command: ["build-task"]                             // <13>
      customConfig:                                         // <14>
        task: "build-webapp"                                // <15>
    - name: "deploy"                                        // <16>
      type: "deploy"                                        // <17>
      tool: "Tekton"                                        // <18>
      jobSpec:
        image: "tekton/deploy:latest"                       // <19>
        command: ["deploy-task"]                            // <20>
      customConfig:                                         // <21>
        task: "deploy-webapp"                               // <22>
  artifacts:
    image: "example/webapp:latest"                          // <23>
  environments:
    variables:
      - name: "ENV"                                         // <24>
        value: "staging"                                    // <25>
----
<1>-<3> Standard resource identification.
<4>-<5> Source repository configuration.
<6>-<8> Webhook trigger settings configured for Tekton.
<9>-<10> "Build" stage definition.
<11> Specifies that Tekton is used for the build stage.
<12>-<13> Job specification for the build stage.
<14>-<15> Custom Tekton configuration for the build task.
<16>-<17> "Deploy" stage definition.
<18> Specifies Tekton is used for the deploy stage.
<19>-<20> Job specification for the deploy stage.
<21>-<22> Custom Tekton configuration for the deploy task.
<23> Artifact produced by the pipeline.
<24>-<25> Environment variable indicating the staging environment.

=== Variation 2: Pipeline Using Jenkins for Testing with Custom Configuration

[source,yaml]
----
apiVersion: ci.example.com/v1alpha1                         // <1>
kind: CIPipeline                                            // <2>
metadata:
  name: webapp-pipeline-jenkins-test                       // <3>
spec:
  source:
    repoURL: "https://github.com/example/webapp.git"        // <4>
    branch: "feature/ci-enhancements"                       // <5>
  triggers:
    type: "manual"                                         // <6>
  stages:
    - name: "test"                                          // <7>
      type: "test"                                          // <8>
      tool: "Jenkins"                                       // <9>
      jobSpec:
        image: "jenkins/inbound-agent:latest"               // <10>
        command: ["sh", "-c", "run-tests.sh"]               // <11>
      customConfig:                                         // <12>
        jobName: "Webapp-Test-Job"                          // <13>
        parameters:                                         // <14>
          - key: "ENV"                                      // <15>
            value: "testing"                                // <16>
  artifacts:
    storage: "http://artifact-server.example.com/artifacts" // <17>
----
<1>-<3> Standard CIPipeline resource identification.
<4>-<5> Source repository and branch details.
<6> Trigger type set to manual.
<7>-<8> "Test" stage definition.
<9> Specifies Jenkins as the CI/CD tool.
<10>-<11> Job specification for the test stage.
<12>-<16> Custom Jenkins configuration with job name and parameters.
<17> Artifact storage location for test results.

== Summary

This document showcased three variations of the `CIPipeline` CRD:

* **CRD 1** – Focuses on defining a pipeline with basic source, trigger, stage, and notification configurations.
* **CRD 2** – Extends the pipeline definition with artifact management and environment-specific settings.
* **CRD 3** – Enhances extensibility by allowing integration with CI/CD tools (such as Tekton and Jenkins) through custom configuration fields.

Each manifest demonstrates different configurations and use cases, illustrating how the CIPipeline CRD can be adapted to various CI/CD workflows while leveraging Kubernetes-native objects for a seamless operational experience.
